# Rime schema
# encoding: utf-8

__include: sbxlm.yaml:/prelude

schema:
  schema_id: sbjm
  name: "声笔简码"
  version: "10.0"
  author:
    - 戴石麟 <https://sbxlm.gitee.io>
    - 蓝落萧 <https://tansongchen.com>
  dependencies:
    - hypy
    - bihua
    - zhlf

switches:
  - name: ascii_mode
    reset: 0
    states: [中文, 西文]
  - name: ascii_punct
    states: [。，, ．，]
  - name: zh_trad
    reset: 0
    states: [简体, 繁体]
  - name: third_pop
    reset: 0
    states: [四顶, 三顶]
  - name: is_enhanced
    reset: 0
    states: [常规, 增强]
  # 为了避免拥挤，不显示下面的状态
  - name: auto_inline
    reset: 1
  - name: is_buffered
    reset: 0
  # 不要改变下面的状态，以免穿帮
  - name: fast_pop
    reset: 0

engine:
  processors:
    - lua_processor@*sbxlm.ascii_composer
    - ascii_composer
    - recognizer
    - lua_processor@*sbxlm.key_binder
    - key_binder
    - lua_processor@*sbxlm.upper_case
    - lua_processor@*sbxlm.selector
    - lua_processor@*sbxlm.popping
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@sbxlm_zdy
    - affix_segmentor@sbjm_zdy
    - affix_segmentor@zhlf_lookup
    - affix_segmentor@bihua_lookup
    - affix_segmentor@pinyin_lookup
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - table_translator@sbxlm_zdy
    - table_translator@sbjm_zdy
    - lua_translator@*sbxlm.auto_length
    - table_translator@bihua_lookup
    - script_translator@pinyin_lookup
    - table_translator@zhlf_lookup
    - lua_translator@*utils.datetime
    - lua_translator@*utils.number
    - lua_translator@*utils.calculator
    - history_translator
  filters:
    - lua_filter@*sbxlm.hint
    - reverse_lookup_filter@bihua_reverse_lookup
    - reverse_lookup_filter@pinyin_reverse_lookup
    - reverse_lookup_filter@zhlf_reverse_lookup
    - simplifier
    - uniquifier
    - lua_filter@*sbxlm.select_key_to_comment

speller:
  alphabet: "bpmfdtnlgkhjqxzcsrywvaeiou0123456789"
  initials: "bpmfdtnlgkhjqxzcsrywv"
  auto_clear: max_length
  max_code_length: 6
  popping:
    __include: sbxlm.yaml:/popping
    __append:
      - match: "[bpmfdtnlgkhjqxzcsrywv].*[aeiou]"
        accept: "[bpmfdtnlgkhjqxzcsrywv]"
      - match: "[bpmfdtnlgkhjqxzcsrywv]{4}"
        accept: "[bpmfdtnlgkhjqxzcsrywv]"
      - when: "third_pop"
        match: "[bpmfdtnlgkhjqxzcsrywv]{3}"
        accept: "[bpmfdtnlgkhjqxzcsrywv]"

translator:
  dictionary: sbjm
  enable_encoder: true
  enable_filtering: false
  lower_case: true
  stop_change: false
  delete_threshold: 2000
  max_phrase_length: 5
  disable_user_dict_for_patterns:
    - "[bpmfdtnlgkhjqxzcsrywv][a-z]?[0123456789]?"

sbjm_zdy:
  dictionary: ""
  user_dict: sbjm_zdy
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 10

punctuator:
  import_preset: sbxlm

recognizer:
  import_preset: sbxlm

key_binder:
  bindings:
    - { when: has_menu, accept: Tab, send: Page_Down }
    - { when: paging, accept: Shift+Tab, send: Page_Up }
    - { when: has_menu, accept: Shift+Tab, send_sequence: "{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}{Page_Down}" }
    - {accept: Tab, send: Page_Down, when: has_menu}
    - match: "[bpmfdtnlgkhjqxzcsrywv]{2}"
      accept: ";"
      send_sequence: "{Home}{Right}{space}{space}"
    - match: "[bpmfdtnlgkhjqxzcsrywv]{3}"
      accept: ";"
      send_sequence: "{Home}{Right}{space}{space}"
    - match: "[bpmfdtnlgkhjqxzcsrywv]{3}"
      accept: Tab
      send_sequence: "{Home}{Right}{Right}{space}{space}"
    - match: "[bpmfdtnlgkhjqxzcsrywv]{3}"
      accept: "'"
      send_sequence: "{Home}{Right}{space}{Home}{Right}{space}{space}"
    - match: "[bpmfdtnlgkhjqxzcsrywv]{4}"
      accept: ";"
      send_sequence: "{Home}{Right}{Right}{space}{space}"
    - match: "[bpmfdtnlgkhjqxzcsrywv]{4}"
      accept: "'"
      send_sequence: "{Home}{Right}{Right}{space}{Home}{Right}{space}{space}"

menu:
  __include: sbxlm.yaml:/prelude/menu
  alternative_select_patterns:
    - "[bpmfdtnlgkhjqxzcsrywv][a-z]{3}[aeuio]{2}"
